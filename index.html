 <m<!DOCTYPE html>
<html lang="en">
<head>
eta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVC Westerlo - Advanced Mental Profiles</title>
    <!-- Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* General Body and Font Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
            user-select: none; /* Prevents text selection during drag */
        }

        /* Player Card Container Styles */
        .player-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            width: 28.7cm; 
            height: 20cm;
            box-sizing: border-box;
            page-break-after: always;
        }

        /* Card Header Styles */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        
        .header-player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-basis: 33%;
        }
        
        .header-player-info img {
             width: 60px;
             height: 60px;
             border-radius: 50%;
             object-fit: cover;
             border: 3px solid #1a2a4c;
             cursor: pointer;
        }
        
        .player-details input {
            border: none;
            background: transparent;
            font-family: inherit;
        }
        .player-details input.player-name-input {
            font-size: 1.6em;
            color: #1a2a4c;
            font-weight: bold;
            width: 100%;
        }
        .player-details input.shirt-number-input {
            font-size: 1.3em;
            color: #555;
            width: 120px;
        }

        .card-header h1 {
            margin: 0;
            font-size: 1.8em;
            color: #1a2a4c;
            font-weight: 700;
            text-align: center;
            flex-basis: 33%;
        }
        
        .header-actions {
            flex-basis: 33%;
            text-align: right;
        }

        /* Main Content Area Layout */
        .card-content {
            display: flex;
            flex-grow: 1;
            gap: 20px;
            overflow: hidden;
        }
        
        /* Main Content Columns */
        .content-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .section-wrapper {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .parameter-section {
            width: 100%;
        }
        
        textarea.section-comment-box {
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #FFF3B0;
            background-color: #FFFAEA;
            border-radius: 8px;
            padding: 8px;
            font-size: 0.8em;
            line-height: 1.3;
            color: #555;
            resize: none;
            font-family: inherit;
            height: 45px; /* Adjusted height */
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .parameter-section h3 {
            margin: 0;
            font-size: 1em;
            color: #1a2a4c;
            padding-bottom: 3px;
            border-bottom: 1px solid #e0e0e0;
            flex-grow: 1;
        }
        
        .average-score-container {
            text-align: center;
            margin-left: 15px;
        }
        .average-score-bullet {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.9em;
            margin: 0 auto;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }
        .average-score-label {
            font-size: 0.6em;
            color: #666;
            margin-top: 2px;
        }
        
        .parameter {
            display: grid;
            grid-template-columns: 110px 1fr;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .parameter-name {
            font-size: 0.85em;
            font-weight: 600;
            text-align: right;
        }
        
        /* Bar Styles */
        .score-bar-container, .multi-option-bar {
            background-color: #e9ecef;
            border-radius: 25px;
            height: 18px;
            width: 100%;
            overflow: hidden;
            position: relative;
            display: flex;
        }
        
        .score-bar-container {
            cursor: pointer;
        }

        .score-bar {
            height: 100%;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .score-value {
            color: white;
            font-weight: bold;
            font-size: 0.7em;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .score-value.dark-text {
            color: #333;
            text-shadow: none;
        }

        .multi-option-bar {
             border: 1px solid #ccc;
        }
        .multi-option {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.6em;
            padding: 0 2px;
            text-align: center;
        }
        .multi-option.selected {
            background-color: #38b000;
            color: white;
            font-weight: 700;
        }
        .multi-option.not-selected {
            background-color: #e9ecef;
            color: #adb5bd;
        }
        
        .pdf-button {
            padding: 8px 16px;
            font-size: 0.9em;
            font-weight: 600;
            color: white;
            background-color: #1a2a4c;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .pdf-button:hover {
            background-color: #2c4a8a;
        }

        /* Print-specific styles */
        @media print {
            body { background-color: #fff; padding: 0; margin: 0; }
            .player-card { box-shadow: none; border: 1px solid #ccc; margin: 0; border-radius: 0; width: 100%; height: 100%; }
            .no-print { display: none !important; }
            textarea.section-comment-box { border-color: #FFC300; }
        }
    </style>
</head>
<body>

    <div id="cards-container"></div>

    <script>
        // --- PLAYER DATA ---
        let playerData = [
            {
                fullName: "Roman Neust√§dter",
                shirtNumber: 6,
                photoUrl: "https://placehold.co/300x300/1a2a4c/ffffff?text=RN",
                data: {
                    leadership: { "Overall": 8, "By Example": 9, "Vocal": 7 },
                    personality: { "Extroversion Energy": "Medium" },
                    communication: { "Clarity": 7, "Receptiveness": 6 },
                    englishLanguage: { "Comprehension": 9, "Fluency": 8 },
                    mentalSkills: { "Resilience": 8, "Psychological Energy": 7, "Achievement Drive": 9, "Growth Mindset": 7 },
                    copingSkills: { "Stress Control": 8, "Anxiety Control": 7, "Game Management": 9 },
                    cognitiveProfile: { "Motivation": "Away From Pain", "Focus Style": "Problem Focus", "Action Style": "Reactive", "Information Style": "Specific (Details)", "Reasoning Style": "Procedural", "Primary System": "Auditory" },
                    comments: {
                        leadership: "Leads with experience but communication can become negative under pressure.",
                        personality: "Balanced energy. Not overly expressive but stable.",
                        communication: "Instructions are clear but can be harsh. Not always open to feedback in the moment.",
                        englishLanguage: "Fully proficient.",
                        mentalSkills: "High drive to succeed and very resilient to setbacks. Mindset is more fixed on what he knows.",
                        copingSkills: "Excellent at managing game situations and controlling stress. Can show anxiety when things go wrong.",
                        cognitiveProfile: "Needs clear, step-by-step instructions. Motivated by preventing mistakes. Analyzes situations before acting."
                    }
                }
            },
            {
                fullName: "Serhiy Sydorchuk",
                shirtNumber: 8,
                photoUrl: "https://placehold.co/300x300/c2a100/ffffff?text=SS",
                data: {
                    leadership: { "Overall": 9, "By Example": 8, "Vocal": 9 },
                    personality: { "Extroversion Energy": "Med Low" },
                    communication: { "Clarity": 9, "Receptiveness": 8 },
                    englishLanguage: { "Comprehension": 7, "Fluency": 6 },
                    mentalSkills: { "Resilience": 9, "Psychological Energy": 8, "Achievement Drive": 8, "Growth Mindset": 8 },
                    copingSkills: { "Stress Control": 9, "Anxiety Control": 9, "Game Management": 8 },
                    cognitiveProfile: { "Motivation": "Towards Pleasure", "Focus Style": "Solution Focus", "Action Style": "Proactive", "Information Style": "Global (Big Picture)", "Reasoning Style": "Optional", "Primary System": "Kinesthetic" },
                     comments: {
                        leadership: "The on-field coach. Understands and directs the team's tactical shape.",
                        personality: "Calm and composed, energy is focused and not wasted.",
                        communication: "Excellent at giving constructive, tactical feedback.",
                        englishLanguage: "Good understanding, but can be hesitant when speaking.",
                        mentalSkills: "Extremely resilient and maintains high energy throughout. Open to new ideas.",
                        copingSkills: "Master of controlling his own emotional state and the tempo of the game.",
                        cognitiveProfile: "Sees the overall game plan and finds creative solutions. Motivated by achieving success. Takes initiative."
                    }
                }
            }
        ];

        // --- EMPTY PROFILE TEMPLATE ---
        const emptyProfileTemplate = {
            fullName: "",
            shirtNumber: "",
            photoUrl: "https://placehold.co/300x300/cccccc/ffffff?text=Upload",
            data: {
                leadership: { "Overall": 5, "By Example": 5, "Vocal": 5 },
                personality: { "Extroversion Energy": "Medium" },
                communication: { "Clarity": 5, "Receptiveness": 5 },
                englishLanguage: { "Comprehension": 5, "Fluency": 5 },
                mentalSkills: { "Resilience": 5, "Psychological Energy": 5, "Achievement Drive": 5, "Growth Mindset": 5 },
                copingSkills: { "Stress Control": 5, "Anxiety Control": 5, "Game Management": 5 },
                cognitiveProfile: { "Motivation": "Towards Pleasure", "Focus Style": "Solution Focus", "Action Style": "Proactive", "Information Style": "Global", "Reasoning Style": "Optional", "Primary System": "Visual" },
                comments: { leadership: "", personality: "", communication: "", englishLanguage: "", mentalSkills: "", copingSkills: "", cognitiveProfile: "" }
            }
        };

        // Add 5 empty profiles
        for (let i = 0; i < 5; i++) {
            playerData.push(JSON.parse(JSON.stringify(emptyProfileTemplate)));
        }


        function getScoreBackground(value) {
            const red = '#EF233C', orange = '#FFA500', yellow = '#FFFF00', 
                  lightGreen = '#ADFF2F', green = '#7CFC00', fullGreen = '#32CD32', darkGreen = '#228B22';
            if (value <= 4) return `background-color: ${red};`;
            if (value === 5) return `background: linear-gradient(to right, ${orange} 60%, ${yellow} 100%);`;
            if (value === 6) return `background: linear-gradient(to right, ${orange} 25%, ${yellow} 75%);`;
            if (value === 7) return `background: linear-gradient(to right, ${yellow} 50%, ${lightGreen} 100%);`;
            if (value === 8) return `background: linear-gradient(to right, ${lightGreen} 50%, ${green} 100%);`;
            if (value === 9) return `background-color: ${fullGreen};`;
            if (value >= 10) return `background-color: ${darkGreen};`;
            return `background-color: #cccccc;`;
        }
        
        function getAverageScoreBackground(value) {
             const red = '#EF233C', orange = '#FFA500', lightGreen = '#ADFF2F', fullGreen = '#32CD32';
            if (value < 5) return red;
            if (value < 7) return orange;
            if (value < 8) return lightGreen;
            return fullGreen;
        }

        function createParameterHTML(player, playerIndex) {
            let html = '';
            const sections = {
                leadership: { title: "Leadership Profile", type: 'score' },
                personality: { title: "Personality Profile", type: 'multi', options: { "Extroversion Energy": ["Low", "Med Low", "Medium", "High"] } },
                communication: { title: "Communication", type: 'score' },
                englishLanguage: { title: "English Language", type: 'score' },
                mentalSkills: { title: "Mental Skills", type: 'score' },
                copingSkills: { title: "Coping Skills", type: 'score' },
                cognitiveProfile: { title: "Cognitive & Motivational Profile", type: 'multi', options: {
                    "Motivation": ["Towards Pleasure", "Away From Pain"],
                    "Focus Style": ["Solution Focus", "Problem Focus"],
                    "Action Style": ["Proactive", "Reactive"],
                    "Information Style": ["Global", "Specific"],
                    "Reasoning Style": ["Optional", "Procedural"],
                    "Primary System": ["Visual", "Auditory", "Kinesthetic"]
                }}
            };

            const column1Keys = ['leadership', 'personality', 'communication', 'englishLanguage'];
            const column2Keys = ['mentalSkills', 'copingSkills', 'cognitiveProfile'];
            
            let column1HTML = '';
            let column2HTML = '';

            Object.keys(sections).forEach(sectionKey => {
                const section = sections[sectionKey];
                const commentText = player.data.comments[sectionKey] || "";
                
                let averageScoreHTML = '';
                if (section.type === 'score') {
                    const scores = Object.values(player.data[sectionKey]);
                    const sum = scores.reduce((a, b) => a + b, 0);
                    const avg = (sum / scores.length).toFixed(1);
                    averageScoreHTML = `<div class="average-score-container"><div class="average-score-bullet" style="background-color: ${getAverageScoreBackground(avg)}">${avg}</div><div class="average-score-label">average</div></div>`;
                }

                let sectionHTML = `<div class="section-wrapper"><div class="parameter-section"><div class="section-header"><h3>${section.title}</h3>${averageScoreHTML}</div>`;
                
                for (const paramKey in player.data[sectionKey]) {
                    const value = player.data[sectionKey][paramKey];
                    sectionHTML += `<div class="parameter"><div class="parameter-name">${paramKey}</div>`;

                    if (section.type === 'score') {
                        const textColorClass = (value >= 5 && value <= 7) ? 'dark-text' : '';
                        sectionHTML += `<div class="score-bar-container" data-player-index="${playerIndex}" data-section="${sectionKey}" data-param="${paramKey}"><div class="score-bar" style="width: ${value * 10}%; ${getScoreBackground(value)}"><span class="score-value ${textColorClass}">${value}</span></div></div>`;
                    } else if (section.type === 'multi') {
                        sectionHTML += `<div class="multi-option-bar">`;
                        section.options[paramKey].forEach(option => {
                            const isSelected = (option === value);
                            sectionHTML += `<div class="multi-option ${isSelected ? 'selected' : 'not-selected'}">${option}</div>`;
                        });
                        sectionHTML += `</div>`;
                    }
                    sectionHTML += `</div>`;
                }
                sectionHTML += `</div><textarea class="section-comment-box" placeholder="Click to add a note...">${commentText}</textarea></div>`;
                
                if (column1Keys.includes(sectionKey)) {
                    column1HTML += sectionHTML;
                } else {
                    column2HTML += sectionHTML;
                }
            });

            return `<div class="content-column">${column1HTML}</div><div class="content-column">${column2HTML}</div>`;
        }

        function generatePlayerCards() {
            const container = document.getElementById('cards-container');
            if (!container) return;

            let allCardsHTML = '';
            playerData.forEach((player, index) => {
                const parametersHTML = createParameterHTML(player, index);
                const cardId = `player-card-${index}`;
                
                allCardsHTML += `
                    <div class="player-card" id="${cardId}" data-player-index="${index}">
                        <div class="card-header">
                             <div class="header-player-info">
                                <img id="photo-${index}" src="${player.photoUrl}" alt="Photo of ${player.fullName}" onclick="triggerPhotoUpload('${index}')" onerror="this.onerror=null;this.src='https://placehold.co/300x300/cccccc/ffffff?text=Photo';">
                                <div class="player-details">
                                    <input type="text" class="player-name-input" value="${player.fullName}" placeholder="Player Name" onchange="updatePlayerData(${index}, 'fullName', this.value)">
                                    <input type="text" class="shirt-number-input" value="${player.shirtNumber ? 'Shirt Number: ' + player.shirtNumber : ''}" placeholder="Shirt Number" onchange="updatePlayerData(${index}, 'shirtNumber', this.value.replace('Shirt Number: ', ''))">
                                </div>
                             </div>
                            <h1>Mental Profile</h1>
                            <div class="header-actions no-print">
                                 <button class="pdf-button" onclick="saveCardAsPDF('${cardId}')">Save as PDF</button>
                            </div>
                        </div>
                        <div class="card-content">
                            ${parametersHTML}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = allCardsHTML;
            addDragListeners();
        }
        
        function updatePlayerData(playerIndex, key, value) {
            playerData[playerIndex][key] = value;
        }

        function triggerPhotoUpload(index) {
            document.getElementById(`upload-${index}`).click();
        }

        function handlePhotoUpload(event, index) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(`photo-${index}`).src = e.target.result;
                    playerData[index].photoUrl = e.target.result; // Save for PDF
                }
                reader.readAsDataURL(file);
            }
        }
        
        // --- DRAGGABLE SCORE BAR LOGIC ---
        let currentDragElement = null;

        function addDragListeners() {
            const scoreBarContainers = document.querySelectorAll('.score-bar-container');
            scoreBarContainers.forEach(container => {
                container.addEventListener('mousedown', startDrag);
                container.addEventListener('touchstart', startDrag, { passive: false });
            });
        }

        function startDrag(e) {
            e.preventDefault();
            currentDragElement = e.currentTarget;
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            updateScoreFromEvent(e);
        }

        function drag(e) {
            if (!currentDragElement) return;
            e.preventDefault();
            updateScoreFromEvent(e);
        }
        
        function endDrag() {
            currentDragElement = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function updateScoreFromEvent(e) {
            const rect = currentDragElement.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            let x = clientX - rect.left;
            let percentage = (x / rect.width) * 100;
            
            percentage = Math.max(0, Math.min(100, percentage));
            let score = Math.round(percentage / 10);
            score = Math.max(1, Math.min(10, score));

            // Update UI
            const scoreBar = currentDragElement.querySelector('.score-bar');
            const scoreValue = currentDragElement.querySelector('.score-value');
            scoreBar.style.width = `${score * 10}%`;
            scoreBar.style.cssText += getScoreBackground(score);
            scoreValue.textContent = score;
            scoreValue.classList.toggle('dark-text', score >= 5 && score <= 7);

            // Update Data Model
            const playerIndex = currentDragElement.dataset.playerIndex;
            const section = currentDragElement.dataset.section;
            const param = currentDragElement.dataset.param;
            playerData[playerIndex].data[section][param] = score;
        }

        // --- PDF GENERATION LOGIC ---
        function saveCardAsPDF(cardId) {
            const element = document.getElementById(cardId);
            const playerName = element.querySelector('.player-name-input').value || "Unnamed_Player";
            const filename = `${playerName}_MentalProfile.pdf`;
            
            const textareas = element.querySelectorAll('textarea.section-comment-box');
            textareas.forEach(textarea => {
                const printableDiv = document.createElement('div');
                printableDiv.className = 'section-comment-box printable-comment';
                printableDiv.textContent = textarea.value;
                textarea.style.display = 'none';
                textarea.parentNode.insertBefore(printableDiv, textarea.nextSibling);
            });
            
            const inputs = element.querySelectorAll('.player-details input');
            inputs.forEach(input => {
                 const printableText = document.createElement('div');
                 printableText.className = input.className;
                 printableText.textContent = input.value;
                 input.style.display = 'none';
                 input.parentNode.insertBefore(printableText, input);
            });


            const opt = {
                margin:       [5, 5, 5, 5],
                filename:     filename,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };

            const button = element.querySelector('.pdf-button');
            if (button) button.style.display = 'none';

            html2pdf().set(opt).from(element).save().then(() => {
                if (button) button.style.display = 'block';
                element.querySelectorAll('.printable-comment').forEach(div => div.remove());
                textareas.forEach(textarea => textarea.style.display = 'block');
                element.querySelectorAll('.player-details div').forEach(div => div.remove());
                inputs.forEach(input => input.style.display = 'block');
            });
        }

        window.onload = generatePlayerCards;
    </script>
</body>
</html>
